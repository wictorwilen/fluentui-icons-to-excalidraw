# Agent Operations Guide

This repository is fully automated. Every script, configuration file, and artifact was generated by GitHub Copilot, and the same tooling can keep the project up to date. This document summarizes the moving parts so an agent can reproduce or extend the pipeline without additional discovery work.

## Purpose

Convert the Microsoft-owned Fluent UI regular, filled, and color icon sets into hand-drawn style Excalidraw scenes, optionally bundled into grouped boards. All source SVGs remain subject to the Fluent UI System Icons license; the glue code here is MIT licensed.

## Environment

- Python 3.9+
- Internet access for GitHub asset downloads
- Optional: `GITHUB_TOKEN` to raise API rate limits during fetches
- Recommended: isolated virtual environment (see README for activation commands)

## Directory Layout

- `scripts/fetch_icons.py`: Pulls metadata and SVG assets into `metadata/icons.json` and `vendor/icons/assets`. Supports optional filtering when a "used icons" directory is provided.
- `scripts/path_parser.py`: Simplifies and normalizes SVG path data for downstream conversion.
- `scripts/svg_to_excalidraw.py`: Converts cached SVGs into `.excalidraw` scenes using a consistent sketch style (4× scale, stroke `#1e1e1e`, fill `#1971c2` where applicable, roughness 1).
- `scripts/fetch_emojis.py`: Downloads Fluent UI emoji metadata and SVG assets from GitHub API, supporting flat style and skin tone variations.
- `scripts/emoji_to_excalidraw.py`: Converts emoji SVGs to Excalidraw format with intelligent color mapping to preserve vibrant flat emoji colors.
- `scripts/combine_excalidraw.py`: Groups individual scenes into larger boards. Handles layout geometry and variant filtering for both icons and emojis.
- `config/icon_categories.json`: Maintains keyword buckets for the category grouping strategy, including emoji categories.
- `vendor/icons/`: Cached Fluent UI SVG payloads, mirroring upstream paths.
- `vendor/emojis/`: Cached Fluent UI emoji SVG payloads.
- `metadata/`: JSON manifests describing every downloaded icon and emoji.
- `artifacts/`: Generated Excalidraw scenes (`artifacts/excalidraw`, `artifacts/excalidraw_emojis`) and optional grouped boards. Git ignores this directory.

## Core Workflows

### Fetch Icons

```bash
python3 scripts/fetch_icons.py \
  --output metadata/icons.json \
  --download-dir vendor/icons \
  --force
```

Key flags:
- `--force`: overwrite existing metadata and asset cache.
- `--used-dir PATH`: limit downloads to icons referenced inside PATH.
- `--include-all`: override `--used-dir` filtering and fetch every icon.

### Convert to Excalidraw

```bash
python3 scripts/svg_to_excalidraw.py \
  --input-dir vendor/icons/assets \
  --output-dir artifacts/excalidraw
```

Outputs one `.excalidraw` file per source SVG. Summary metrics (processed, converted, duplicates, failed) print to stdout for monitoring.

### Fetch Emojis

```bash
python3 scripts/fetch_emojis.py \
  --output metadata/emojis.json \
  --download-dir vendor/emojis \
  --force
```

Key flags:
- `--force`: overwrite existing metadata and asset cache.
- `--limit N`: limit downloads to N emojis for testing.
- `--preferred-style flat`: use flat style emojis (only supported style for Excalidraw compatibility).

### Convert Emojis to Excalidraw

```bash
python3 scripts/emoji_to_excalidraw.py \
  --input-dir vendor/emojis/assets \
  --output-dir artifacts/excalidraw_emojis
```

Outputs one `.excalidraw` file per source emoji SVG with intelligent color mapping to preserve flat emoji colors.

### Combine Boards

```bash
python3 scripts/combine_excalidraw.py \
  --input-dir artifacts/excalidraw \
  --output artifacts/excalidraw_categories \
  --group-by category \
  --columns 8 \
  --cell-width 220 \
  --cell-height 240 \
  --padding 24 \
  --label-gap 12 \
  --exclude-regular
```

Works with both icons and emojis. For emojis, use larger spacing parameters:
```bash
python3 scripts/combine_excalidraw.py \
  --input-dir artifacts/excalidraw_emojis \
  --output artifacts/excalidraw_emoji_categories \
  --group-by category \
  --columns 5 \
  --cell-width 200 \
  --cell-height 180 \
  --padding 35 \
  --label-gap 25
```

Important options:
- `--group-by`: `none`, `directory`, `letter`, `first-word`, `category`, or `batch`.
- `--batch-size`: size per board when using `batch` grouping.
- `--exclude-regular`: omit `_regular` and `_light` variants while keeping filled/color icons.
- When grouping (`group-by != none`), `--output` must point to a directory.
- Category mode heuristically sorts icons into typography, communication, people, navigation, scheduling, data, organization, media, devices, security, commerce, travel, places, nature, health, utilities, symbols, and a final Other bucket.
- Override the default categories with `--categories-file PATH` or edit `config/icon_categories.json` directly.

## Regeneration Checklist

### For Icons:
1. (Optional) Clear previous artifacts: `rm -rf artifacts/excalidraw artifacts/excalidraw_categories`.
2. Fetch new or updated icons (`fetch_icons.py`).
3. Convert to individual Excalidraw files (`svg_to_excalidraw.py`).
4. Combine into boards as needed (`combine_excalidraw.py`).

### For Emojis:
1. (Optional) Clear previous artifacts: `rm -rf artifacts/excalidraw_emojis artifacts/excalidraw_emoji_categories`.
2. Fetch new or updated emojis (`fetch_emojis.py`).
3. Convert to individual Excalidraw files (`emoji_to_excalidraw.py`).
4. Combine into boards as needed (`combine_excalidraw.py`).

## Maintenance Notes

- Every script is idempotent; rerun safely after code changes or upstream icon updates.
- Logging is stdout-based and intended for tailing in CI.
- Treat `vendor/` and `metadata/` as rebuildable caches—do not commit them.
- Adjust styling constants (stroke width, colors, scale) inside `svg_to_excalidraw.py` if the visual presentation changes.
- When you change scripts or add capabilities, update `README.md` so end users see the new behavior and commands.
- Whenever you introduce a new feature, ask the user whether the GitHub Actions workflow should be updated to cover it before making CI changes.
- The GitHub Actions workflow now includes comprehensive emoji processing alongside icon generation.

### **MANDATORY: Changelog Maintenance**
- **ALWAYS update `CHANGELOG.md`** when making any changes to the codebase, especially fixes, enhancements, or new features
- **Keep entries concise and high-level** - focus on what changed for users, not how it was implemented
- **Avoid technical details** like threshold numbers, function names, or code-level specifics
- Follow the [Keep a Changelog](https://keepachangelog.com/en/1.0.0/) format with categories: Added, Changed, Deprecated, Removed, Fixed, Security
- Document the impact on end users and visual/functional improvements rather than code-level changes
- Update the [Unreleased] section for ongoing work - the pre-commit hook will automatically version it on commit

### **Automatic Changelog Versioning**
- **Pre-commit hook automatically versions changelog entries** when committing changes to CHANGELOG.md
- **Converts [Unreleased] to dated version** (e.g., [2025.10.20] - 2025-10-20 13:47:04 UTC)
- **Creates new empty [Unreleased] section** ready for future changes
- **Install the hook**: `cp scripts/hooks/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit`
- **Only activates when CHANGELOG.md has staged changes** and contains actual content in [Unreleased]



## Licensing and Attribution

- Fluent UI icons remain under the [Fluent UI System Icons license](https://github.com/microsoft/fluentui-system-icons). Review before distributing derived assets.
- Repository code and documentation are released under the [MIT License](LICENSE).
- Microsoft owns the Fluent UI trademark and iconography; retain attribution whenever assets leave this environment.
